// Generated by CoffeeScript 1.10.0
(function() {
  var config, misc, weather;

  misc = require('../lib/misc');

  config = require('../lib/config');

  weather = function(cityName) {
    return misc.get('http://api.openweathermap.org/data/2.5/weather', {
      qs: {
        q: cityName,
        units: 'metric',
        appid: config.options.weathermap
      },
      json: true
    }).then(function(res) {
      if (res.cod !== 200) {
        throw new Error(res.message);
      }
      return res;
    });
  };

  module.exports = {
    name: 'Weather',
    pattern: /!(weather|Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğ°)(?: (.+))?/,
    isConf: true,
    onMsg: function(msg, safe) {
      var res, txt;
      txt = msg.match[2];
      if (txt == null) {
        return;
      }
      res = weather(txt);
      return safe(res).then(function(data) {
        var desc, emoji;
        emoji = {
          "â˜€ï¸": data['main']['temp'] + " Â°C",
          "ğŸ’¦": data['main']['humidity'] + "%",
          "ğŸ’¨": data['wind']['speed'] + " km/h / " + data['wind']['deg'] + " deg",
          "ğŸŒ…": "" + (new Date(data['sys']['sunrise'] * 1000).toLocaleTimeString()),
          "ğŸŒ„": "" + (new Date(data['sys']['sunset'] * 1000).toLocaleTimeString())
        };
        desc = data['name'] + ", " + data['sys']['country'] + " - " + data['weather'][0]['main'] + "\n" + data['weather'][0]['description'];
        Object.keys(emoji).map(function(e) {
          return desc += "\n" + e + ": " + emoji[e];
        });
        return msg.reply(desc);
      });
    },
    onError: function(msg) {
      return msg.reply('Ğ“Ğ¾Ñ€Ğ¾Ğ´ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.');
    }
  };

}).call(this);

//# sourceMappingURL=weather.js.map
